<view class="chat _div" style="{{'padding-bottom:'+(isIphoneX?safeBottom+70+'px':'70px')+';'}}" id="chat" data-event-opts="{{[['longpress',[['handleLongPress',['$event']]]],['touchmove',[['handleTouchMove',['$event']]]],['touchend',[['handleTouchEnd',['$event']]]]]}}" bindlongpress="__e" bindtouchmove="__e" bindtouchend="__e"><view class="{{['record-modal _div',isRecording?'':'modal-display']}}"><view class="wrapper _div"><view class="modal-loading _div"></view></view><view class="modal-title _div">{{''+title+''}}</view></view><imodal vue-id="02d35002-1" title="确认下载？" visible="{{modalVisible}}" data-event-opts="{{[['^ok',[['download']]],['^cancel',[['handleModalShow']]]]}}" bind:ok="__e" bind:cancel="__e" bind:__l="__l" vue-slots="{{['default']}}"><view class="input-wrapper _div">{{'进度'+percent+'%'}}</view></imodal><imodal vue-id="02d35002-2" title="发送自定义消息" visible="{{customModalVisible}}" data-event-opts="{{[['^ok',[['sendCustomMessage']]],['^cancel',[['customModal']]]]}}" bind:ok="__e" bind:cancel="__e" bind:__l="__l" vue-slots="{{['default']}}"><view class="custom-wrapper _div"><block wx:if="{{customModalVisible}}"><input class="{{['custom-input',(focusedInput==='data')?'input-focus':'']}}" type="text" placeholder="输入数据" data-event-opts="{{[['focus',[['e0',['$event']]]],['blur',[['e1',['$event']]]],['input',[['__set_model',['','customData','$event',[]]]]]]}}" value="{{customData}}" bindfocus="__e" bindblur="__e" bindinput="__e"/></block><block wx:if="{{customModalVisible}}"><input class="{{['custom-input',(focusedInput==='desc')?'input-focus':'']}}" type="text" placeholder="输入描述" data-event-opts="{{[['focus',[['e2',['$event']]]],['blur',[['e3',['$event']]]],['input',[['__set_model',['','customDescription','$event',[]]]]]]}}" value="{{customDescription}}" bindfocus="__e" bindblur="__e" bindinput="__e"/></block><block wx:if="{{customModalVisible}}"><input class="{{['custom-input',(focusedInput==='ext')?'input-focus':'']}}" type="text" placeholder="输入其他" data-event-opts="{{[['focus',[['e4',['$event']]]],['blur',[['e5',['$event']]]],['input',[['__set_model',['','customExtension','$event',[]]]]]]}}" value="{{customExtension}}" bindfocus="__e" bindblur="__e" bindinput="__e"/></block></view></imodal><imodal vue-id="02d35002-3" title="对IM demo的评分和评价" i-class="custom-modal" visible="{{rateModal}}" data-event-opts="{{[['^ok',[['sendSurvey']]],['^cancel',[['e6']]]]}}" bind:ok="__e" bind:cancel="__e" bind:__l="__l" vue-slots="{{['default']}}"><view class="custom-wrapper _div"><irate vue-id="{{('02d35002-4')+','+('02d35002-3')}}" value="{{rate}}" data-event-opts="{{[['^change',[['onChange']]]]}}" bind:change="__e" bind:__l="__l"></irate><block wx:if="{{rateModal}}"><input class="custom-input" type="text" placeholder="输入评价" data-event-opts="{{[['input',[['__set_model',['','customExtension','$event',[]]]]]]}}" value="{{customExtension}}" bindinput="__e"/></block></view></imodal><imodal vue-id="02d35002-5" title="提示" i-class="custom-modal" visible="{{revokeModal}}" data-event-opts="{{[['^ok',[['handleRevokeMessage']]],['^cancel',[['e7']]]]}}" bind:ok="__e" bind:cancel="__e" bind:__l="__l" vue-slots="{{['default']}}"><view class="custom-wrapper _div">确定要撤回本消息吗？</view></imodal><view id="list" data-event-opts="{{[['tap',[['loseFocus',['$event']]]]]}}" bindtap="__e" class="_div"><block wx:for="{{currentMessageList}}" wx:for-item="message" wx:for-index="index" wx:key="ID"><view id="{{message.ID}}" class="_li"><block wx:if="{{message.type==='TIMGroupTipElem'||message.type==='TIMGroupSystemNoticeElem'}}"><view class="notice _div"><view class="content _div"><block wx:for="{{message.virtualDom}}" wx:for-item="div" wx:for-index="index1"><label class="_span"><block wx:if="{{div.name==='groupTip'||'system'}}"><label class="_span">{{div.text}}</label></block></label></block></view></view></block><block wx:else><block wx:if="{{message.isRevoked}}"><view class="_div"><view class="notice _div"><view class="content _div"><block wx:if="{{message.from===myInfo.userID}}">你撤回了一条消息</block><block wx:else>{{message.from+"撤回了一条消息"}}</block></view><block wx:if="{{message.from===myInfo.userID}}"><block wx:if="{{currentTime-message.time<120&&message.type==='TIMTextElem'}}"><view data-event-opts="{{[['tap',[['reEdit',['$0'],[[['currentMessageList','ID',message.ID]]]]]]]}}" class="re-edit _div" bindtap="__e">重新编辑</view></block></block></view></view></block><block wx:else><view class="{{['_div',message.flow==='out'?'item-right':'item-left']}}"><view class="content _div"><view class="name _div"><block wx:if="{{currentConversation.type==='C2C'}}"><block wx:if="{{message.flow==='in'}}">{{''+(currentConversation.userProfile.nick||currentConversation.userProfile.userID)+''}}</block><block wx:else>{{''+(myInfo.nick||myInfo.userID)+''}}</block></block><block wx:else>{{''+(message.nameCard||message.nick||myInfo.nick||message.from)+''}}</block></view><view data-event-opts="{{[['longpress',[['handleMessage',['$0'],[[['currentMessageList','ID',message.ID]]]]]]]}}" class="wrapper _div" bindlongpress="__e"><block wx:if="{{currentConversation.type==='C2C'&&message.from===myInfo.userID&&message.status==='success'}}"><view class="name read-receipts _div"><block wx:if="{{message.isPeerRead}}">已读</block><block wx:else>未读</block></view></block><block wx:if="{{message.from===myInfo.userID}}"><view data-event-opts="{{[['tap',[['handleResend',['$0'],[[['currentMessageList','ID',message.ID]]]]]]]}}" class="load _div" bindtap="__e"><view class="{{['_div',message.status]}}"></view></view></block><block wx:if="{{message.type==='TIMTextElem'}}"><view class="message _div"><view class="text-message _div"><block wx:for="{{message.virtualDom}}" wx:for-item="div" wx:for-index="index2"><label class="_span"><block wx:if="{{div.name==='span'}}"><label class="_span">{{div.text}}</label></block><block wx:if="{{div.name==='img'}}"><image style="width:20px;height:20px;" src="{{div.src}}"></image></block></label></block></view></view></block><block wx:else><block wx:if="{{message.type==='TIMImageElem'}}"><image class="image-message" src="{{message.payload.imageInfoArray[1].url}}" mode="widthFix" data-event-opts="{{[['tap',[['previewImage',['$0'],[[['currentMessageList','ID',message.ID,'payload.imageInfoArray.__$n1.url']]]]]]]}}" bindtap="__e"></image></block><block wx:else><block wx:if="{{message.type==='TIMFileElem'}}"><view class="message _div"><view data-event-opts="{{[['tap',[['handleDownload',['$0'],[[['currentMessageList','ID',message.ID,'payload']]]]]]]}}" class="file _div" bindtap="__e"><iavatar vue-id="{{'02d35002-6-'+index}}" src="../../static/images/file.png" size="large" shape="square" bind:__l="__l"></iavatar><view class="_div">{{message.payload.fileName}}</view></view></view></block><block wx:else><block wx:if="{{message.type==='TIMCustomElem'}}"><view class="message _div"><block wx:if="{{message.payload.data==='survey'}}"><view class="survey _div"><view class="title _div">对IM DEMO的评分和建议</view><view class="description _div"><irate vue-id="{{'02d35002-7-'+index}}" disabled="true" value="{{message.payload.description}}" bind:__l="__l"></irate></view><view class="suggestion _div"><view class="_div">{{message.payload.extension}}</view></view></view></block><block wx:else><block wx:if="{{message.payload.data==='group_create'}}"><view class="_div"><view class="_div">{{message.payload.extension}}</view></view></block><block wx:else><block wx:if="{{message.virtualDom[0].name==='videoCall'}}"><view class="custom-elem _div"><view class="_div">{{message.virtualDom[0].text}}</view></view></block><block wx:else><view class="custom-elem _div">自定义消息</view></block></block></block></view></block><block wx:else><block wx:if="{{message.type==='TIMSoundElem'}}"><view class="message _div" url="{{message.payload.url}}"><view data-event-opts="{{[['tap',[['openAudio',['$0'],[[['currentMessageList','ID',message.ID,'payload']]]]]]]}}" class="box _div" bindtap="__e"><image style="height:22px;width:22px;" src="../../static/images/audio-play.png"></image><view style="padding-left:4px;" class="_div">{{message.payload.second+"s"}}</view></view></view></block><block wx:else><block wx:if="{{message.type==='TIMFaceElem'}}"><view class="message _div"><view class="custom-elem _div"><image style="height:90px;width:90px;" src="{{faceUrl+message.payload.data+'.png'}}"></image></view></view></block><block wx:else><block wx:if="{{message.type==='TIMVideoFileElem'}}"><view class="message _div"><video class="video" src="{{message.payload.videoUrl}}" poster="{{message.payload.thumbUrl}}" object-fit="contain" data-event-opts="{{[['error',[['videoError',['$event']]]]]}}" binderror="__e"></video></view></block></block></block></block></block></block></block></view></view><view class="_div"><block wx:if="{{message.flow==='out'}}"><iavatar vue-id="{{'02d35002-8-'+index}}" i-class="avatar" src="{{myInfo.avatar}}" shape="square" bind:__l="__l"></iavatar></block><block wx:else><block wx:if="{{currentConversation.type==='C2C'}}"><iavatar vue-id="{{'02d35002-9-'+index}}" i-class="avatar" shape="square" src="{{currentConversation.userProfile.avatar}}" data-event-opts="{{[['^click',[['toDetail']]]]}}" bind:click="__e" bind:__l="__l"></iavatar></block><block wx:else><iavatar vue-id="{{'02d35002-10-'+index}}" i-class="avatar" shape="square" src="{{message.avatar}}" data-event-opts="{{[['^click',[['toDetail',[['o',['userID',message.from]]]]]]]}}" bind:click="__e" bind:__l="__l"></iavatar></block></block></view></view></block></block></view></block></view><view class="bottom _div" style="{{'padding-bottom:'+(isIphoneX?safeBottom+'px':'')+';'}}"><view class="bottom-div _div"><view data-event-opts="{{[['tap',[['chooseRecord',['$event']]]]]}}" class="btn-left _div" bindtap="__e"><icon src="{{!isRecord?'../../images/audio.png':'../../images/record.png'}}" size="{{28}}"></icon></view><block wx:if="{{!isRecord}}"><view style="width:100%;" class="_div"><input class="input" type="text" confirm-type="send" cursor-spacing="10" focus="{{isFocus}}" data-event-opts="{{[['focus',[['e8',['$event']]]],['blur',[['e9',['$event']]]],['confirm',[['sendMessage',['$event']]]],['input',[['__set_model',['','messageContent','$event',[]]]]]]}}" value="{{messageContent}}" bindfocus="__e" bindblur="__e" bindconfirm="__e" bindinput="__e"/></view></block><block wx:if="{{isRecord}}"><view class="record _div" id="record"><block wx:if="{{!isRecording}}">按住 说话</block><block wx:if="{{isRecording}}">抬起 停止</block></view></block><view data-event-opts="{{[['tap',[['handleEmoji']]]]}}" class="btn _div" bindtap="__e"><icon src="../../images/smile.png" size="{{28}}"></icon></view><block wx:if="{{messageContent.length!==0}}"><view data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" class="send _div" bindtap="__e">发送</view></block><block wx:else><view data-event-opts="{{[['tap',[['handleMore']]]]}}" class="btn _div" bindtap="__e"><icon src="../../images/more.png" size="{{28}}"></icon></view></block></view><block wx:if="{{isEmojiOpen}}"><view class="bottom-emoji _div"><view class="emoji-tab _div"><view class="tabs _div"><view data-event-opts="{{[['tap',[['handleEmojiShow',['$event']]]]]}}" class="{{['single _div',emojiShow?'choosed':'']}}" bindtap="__e"><image style="width:100%;height:100%;" src="../../static/images/smile.png"></image></view></view></view><block wx:if="{{emojiShow}}"><view class="emojis _div"><block wx:for="{{emojiName}}" wx:for-item="emojiItem" wx:for-index="index3" wx:key="*this"><view data-event-opts="{{[['tap',[['chooseEmoji',['$0'],[[['emojiName','',index3]]]]]]]}}" class="emoji _div" bindtap="__e"><image style="width:100%;height:100%;" src="{{emojiUrl+emojiMap[emojiItem]}}"></image></view></block></view></block></view></block><block wx:if="{{isMoreOpen}}"><view class="bottom-image _div"><view class="images _div"><view data-event-opts="{{[['tap',[['sendPhoto',['camera']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/take-pic.png"></image></view><view class="name _div">拍摄</view></view><view data-event-opts="{{[['tap',[['sendPhoto',['album']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/picture.png"></image></view><view class="name _div">图片</view></view><view data-event-opts="{{[['tap',[['customModal']]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/custom.png"></image></view><view class="name _div">自定义消息</view></view><view data-event-opts="{{[['tap',[['e10',['$event']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/rating.png"></image></view><view class="name _div">评分</view></view></view><view class="images _div"><view data-event-opts="{{[['tap',[['video',['$event']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/video-file.png"></image></view><view class="name _div">视频</view></view><block wx:if="{{currentConversation.type==='C2C'}}"><view data-event-opts="{{[['tap',[['videoCall',['$event']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/video.png"></image></view><view class="name _div">视频通话</view></view></block></view></view></block></view><view class="float-button-list _div"><block wx:if="{{currentConversation.type==='C2C'}}"><image class="video-icon _img" src="{{$root.m0}}" data-event-opts="{{[['tap',[['videoCall',['$event']]]]]}}" bindtap="__e"></image></block><image src="{{$root.m1}}" data-event-opts="{{[['tap',[['toDetail',['$event']]]]]}}" bindtap="__e" class="_img"></image></view></view>